<style>
table {
	border: 2px solid black;
	display:inline;
	border-spacing:0px
}
</style>
<!-- <table class="yo"><td></td></table> -->

<body>
# ZAREK'S VINA DOCKING SYSTEM #

#### &#169; Zarek Siegel, updated 3/10/16
#### Erika Taylor Group, Department of Chemistry, Wesleyan University

* * *

## Description (to be written)
High platforms team leverage enthusiastically high infrastructures utilize
convergence functionalized action capital. Than growth multimedia viral
alternative emerging infrastructures e-enable sucking fashion capital
niches standards. Extensible "organic" team re-engineer reinvent quality
leading-edge paradigms cultivate infrastructures energistically dynamic.
Art holisticly covalent leverage initiatives enterprise interoperable
empowerment actualize collaborative invested chains utilize expedite
corporate. Improvements potentialities results energistically streamline
completely positioning brand adaptive team visualize of holistic infrastructures.

## File Structure
* <font style="font-variant:small-caps">Notes:</font>
	* ***`bolded-italicized`*** files/directories need to be created by the user
	* **`bolded`** files/directories/names need to be modified by the user
	* *`italicized`* files and directories are created by scripts
	* `plain` files and directories do not (and should not) by modified
	* `$ command` indicates a command line command in the terminal
	* directories and files (and parts of file names) in lower case must
	included exactly as indicated
	* directories and files in all caps should be named appropriately to
	the proteins and dockings in question
* <table class="yo"><td>**`base_dir`**</td></table> - The root of the system is the base directory, containing all other
files (probably best not to put anything else in this folder but what's indicated below)
	* <table class="yo"><td>`Readme.md`</td></table>
	\- This file
	* <table class="yo"><td>**`Dockings.csv`**</td></table>
	\- A spreadsheet containing master docking parameters
	* <table class="yo"><td>**`Gridboxes.csv`**</td></table>
	\- A spreadsheet specifying all the grid box parameters
	* <table class="yo"><td>`ligsets/`</td></table>
	\- A directory containing all the sets of ligands
		* <table class="yo"><td>***`ligsets/LIGSET/`*** </td></table>
		\- for each set, the there should be a directory
		within the `ligsets/` directory, whose name is the name of the ligand set.
		Substitute `LIGSET` for some appropriate name (e.g. `ligsets/my_awesome_ligset/`)
			* <table class="yo"><td>***`ligsets/LIGSET/pdbqts/`***</td></table>
			\- a directory containing a PDBQT file for
			each ligand in the set (whose name is `LIG.pdbqt`, with `LIG` being exactly
			the same as in `ligsets/LIGSET/LIGSET_list.txt`) [may be scripted later]
			* <table class="yo"><td>***`ligsets/LIGSET/LIGSET_list.txt`***</td></table>
			\- a text file containing a list of
			all the ligands (one on each line) and nothing else
				* you can create this easily on the command line using:
				`$ cd base_dir/ligsets/; for l in $(ls LIGSET/pdbqts |
				sed 's/.pdbqt//'); do echo $l >> LIGSET/LIGSET_list.txt; done`
				(appropriately substituting `base_dir` and `LIGSET`, and
				assuming the PDBQTs are already made)
			* [optional/preliminary] `ligsets/LIGSET/LIGSET.cdxml/`
			or `ligsets/LIGSET/LIGSET.mol/`
			\- one file to show all the ligands in one page
			for presentations, PDF-making and such.
			* [optional/preliminary] `ligsets/LIGSET/mols/`
			and `ligsets/LIGSET/pdbs/` - directories
			for preparing the initial PDBQT files. Will either be optional, or
			more scripts will be written.
	* <table class="yo"><td>`parameters_csvs/`</td></table> - A directory containing small CSV files specifying the
	docking parameters for each individual docking (needed for scripts, at least as of now).
	Generated by `scripts/write_params_csv.R` from information in `Gridboxes.csv`
		* They will be named <table class="yo"><td>*`parameters_csvs/DOCKING_parameters.csv`*</td></table>, where
		`DOCKING` is the docking ID
	* <table class="yo"><td>`vina_submit_shs/`</td></table>
	\- A directory containing the submission files for Vina jobs on the
	(Wesleyan) cluster. Generated by `write_vina_submit` function of `docking_data_assembly.py`
		* <table class="yo"><td>*`vina_submit_shs/vina_submit_DOCKING.sh`*</td></table>
		\- for a docking of 20 models or less, a
		single submission script is written (and submitted
		using `$ bsub < vina_submit_DOCKING.sh`, see submission instructions below)
		* <table class="yo"><td>*`vina_submits_DOCKING/`*</td></table>
		\- dockings of more than 20 models need to be submitted with multiple scripts
		(because Vina will not generate more than 20 poses). In this case, the
		`write_vina_submit` function will create a directory called `vina_submits_DOCKING/`
		containing *n* scripts
		<table class="yo"><td>*`vina_submit_DOCKING.1.sh`*</td></table>,
		<table class="yo"><td>*`vina_submit_DOCKING.2.sh`*</td></table> through
		<table class="yo"><td>*`vina_submit_DOCKING.n.sh`*</td></table>
		. This script is set up to write each *n* submission scripts,
		where each of which script has a model number of 20 and *n* is the number
		of models divided by 20. Therefore, if greater than 20, the number of models
		should always be a multiple of twenty, or things will get messed up. (These
		are submitted used `$ for s in $(ls vina_submits_DOCKING); do bsub < $s; done`,
		see instructions below)
	* <table class="yo"><td>***`PROTEIN/`***</td></table>, etc. - A directory for *each* protein, whose name is
	the name of the protein, the reference name/abbreviation used throughout,
	it just needs to be consistent (e.g. I primarily dock the proteins HepI and
	p300 and have the directories `hepi/` and `p300/` in my `base_dir/`)
		* <table class="yo"><td>***`PROTEIN/PROTEIN.pdbqt`***</td></table>
		\- the PDBQT file to be used for docking
		(`PROTEIN` must be *exactly* the same for the directory/file names and
		in the `Dockings.csv` and `Gridboxes.csv` entries for the protein's dockings)
		[may be scripted later, from `PROTEIN.pdb`]
		* [optional/preliminary] `PROTEIN.pdb` - the original PDB file
		* <table class="yo"><td>*`PROT/DOCKING/`*</td></table>
		\- for every docking, there should be a directory
		whose name in the docking ID (the same as in `Dockings.csv`). Note:
		the user shouldn't make this folder, it is made by `vina_submit_DOCKING.sh`.
			* This will eventually contain
		* <table class="yo"><td>***`PROT/binding_sites/`***</td></table>
		\- a directory containing binding site PDBs:
			* To do binding site scoring by residues contacted (which is
			detected by the AutoDockTools script `process_VinaResult.py`),
			There must be one or more `PROT/binding_sites/BINDING_SITE.pdb` files.
			These are subsets of the original `PROTEIN.pdb` (I originally created
			mine by grabbing the residues within 5&Aring; of the bound ligands
			that came with the crystal structure, but it could be done many other ways).
	* <table class="yo"><td>`scripts/`</td></table>
	\- all the scripts needed to use this set up
		* <table class="yo"><td>`write_params_csv.R`</td></table>
		\- writes `DOCK_parameters.csv` using information
		in `Dockings.csv` and `Gridboxes.csv`
		* <table class="yo"><td>`load_parameters.sh`</td></table>
		\- loads parameters from `DOCKING_parameters.csv` (used in the next script)
		<!-- * `[[ligand, protein preparation]]` -  -->
		* <table class="yo"><td>`separate_vina_results.sh`</td></table>
		\- runs Vina result PDBQTs through the AutoDockTools script
		`process_VinaResult.py`, which separates the poses into separate files
		and extracts the receptor contacts. The resulting files ended up in
		`DOCKING/processed_pdbqts/`, named `DOCKING_LIGAND_mMODEL.pdbqt`, where
		MODEL is the particular pose represented by the file. (A docking with
		*l* ligands and with Vina set to produce *m* models will therefore
		end up having *l* &times; *m* files after this script runs.)
		* <table class="yo"><td>`cleanup_processed_vina_results.sh`</td></table>
		\- cleans up processed PDBQTs (`DOCKING/processed_pdbqts/DOCKING_LIGAND_mMODEL.pdbqt`)
		and converts then to PDBs using the AutoDockTools script `pdbqt_to_pdb.py`
		* <table class="yo"><td>`parse_pdb.py`</td></table>
		\- defines a object class called `Pdb` for parsing PDB and PDBQT files
		for their 3D coordinates and in the case of processed Vina results,
		their binding energy, protein contacts, and other data generated by Vina.
		(Necessary for `docking_data_assembly.py`.)
		* <table class="yo"><td>`aiad_icpd.py`</td></table>
		\- defines functions to calculate the AIAD (averaged inter-atomic distance)
		and ICPD (inter-centerpoint distance) between two `Pdb` objects, two
		useful parameters for determining where a pose is binding on a protein
		and clustering poses together based on proximity.
		(Necessary for these functions in `docking_data_assembly.py`.)
		<!-- * `[[prepare_clustering_csv.py]]` -  -->
		* <table class="yo"><td>`docking_data_assembly.py`</td></table> -
		defines an object class called `Docking` for preparation and analysis
		of dockings. Contains several important functions:
			* `write_vina_submit` - prepares Vina job submission scripts
			* `assemble_dic` - assembles a data dictionary that contains
			all the mined data from the Vina results
			* `score_binding_sites` - scores each pose for the proportion
			of residues contacted in each reference binding site
			* `assess_all_resis` - uses binding scores to determine a True/False
			for each pose binding in at each binding site (based on a threshold
			score, currently 0.1 or 10%)
			* (`aiad_icpd_binding_sites`) - calculates AIAD and ICPD scores
			for each pose compared to each binding site
			* `write_alldata_csv` - writes the data dictionary to a CSV file
			called `DOCKING_alldata.csv`
			* `cluster_poses` [`prepare_clustering_csv.py`] - calculates AIAD
			scores for every pose compared to every other pose, for cluster
			analysis later on
			<!-- * [[more clustering stuff?]] -->
		* <table class="yo"><td>`pre_and_post_control.py`</td></table>
		\- links to all of the above scripts to coordinate their function,
		providing the global variables required to run this system on
		different computers.
		* *Other scripts that may or may not be added:*
			* A script to add an entry to `Dockings.csv` or `Gridboxes.csv`
			with use input
			*

## Complete listing of included files

* **Notes**:
	* ... indicates more of the same kind of file or directory
	* .py files (except for the control script) may have a compiled .pyc file with them
	* (files) are optional (for now)
	* [files] are works in progress and may not be included ultimately
	* [[files]] need to be made

>		/path/to/base_dir/
			Readme.md
			Dockings.csv
			Gridboxes.csv
			ligsets/
				LIGSET1/
					LIGSET1_list.txt
					(LIGSET1.cdxml)
					(mols/...)
					(pdbs/...)
					pdbqts/
						LIG1_1.pdbqt
						LIG1_2.pdbqt
						LIG1_3.pdbqt
						...
				LIGSET2/
					LIGSET1_list.txt
					(mols/...)
					(pdbs/...)
					pdbqts/
						LIG2_1.pdbqt
						LIG2_2.pdbqt
						LIG2_3.pdbqt
						...
				...
			parameters_csvs/
				A1_parameters.csv
				A2_parameters.csv
				A3_parameters.csv
				B1_parameters.csv
				B2_parameters.csv
				...
			vina_submit_shs/
				vina_submit_A1.sh
				vina_submits_A2/
					vina_submit_A2.1.sh
					vina_submit_A2.2.sh
					vina_submit_A2.3.sh
					...
				vina_submit_B1.sh
				...
			PROT_A/
				(PROT_A.pdb)
				PROT_A.pdbqt
				binding_sites/
					BINDING_SITE_ALPHA1.pdb
					BINDING_SITE_ALPHA2.pdb
					BINDING_SITE_ALPHA3.pdb
					...
				A1/
				A2/
				A3/
				...
			PROT_B/
				(PROT_B.pdb)
				PROT_B.pdbqt
				binding_sites/
					BINDING_SITE_BETA1.pdb
					...
				B1/
				B2/
				...
			...
			scripts/
				[new_grid_or_dock_entry.R]
				[[write_ligset_list_txt.sh]]
				write_params_csv.R
				load_parameters.sh
				[[ligand, protein preparation]]
				separate_vina_results.sh
				cleanup_processed_vina_results.sh
				parse_pdb.py
				aiad_icpd.py
				[[prepare_clustering_csv.py]]
				docking_data_assembly.py
				pre_and_post_control.py
				[[post_docking_graphs.R]]
				[[clustering_graphs.R]]
				[[R cript to select poses to view in PyMol]]
				[[Py script to load PyMol sessions from lists]]

#### After docking post-processing:
			PROTEIN/
				(PROTEIN.pdb)
				PROTEIN.pdbqt
				binding_sites/
					SITE1.pdb
					SITE1.pdb
					SITE1.pdb
					...
				DOCKING/
					result_pdbqts/
						DOCKING_LIG1_results.pdbqt
						DOCKING_LIG2_results.pdbqt
						DOCKING_LIG3_results.pdbqt
						...
					processed_pdbqts/
						DOCKING_LIG1_m1.pdbqt
						DOCKING_LIG1_m2.pdbqt
						DOCKING_LIG1_m3.pdbqt
						...
						DOCKING_LIG2_m1.pdbqt
						DOCKING_LIG2_m2.pdbqt
						DOCKING_LIG2_m3.pdbqt
						...
						DOCKING_LIG3_m1.pdbqt
						DOCKING_LIG3_m2.pdbqt
						DOCKING_LIG3_m3.pdbqt
						...
					processed_pdbs/
						DOCKING_LIG1_m1.pdb
						DOCKING_LIG1_m2.pdb
						DOCKING_LIG1_m3.pdb
						...
						DOCKING_LIG2_m1.pdb
						DOCKING_LIG2_m2.pdb
						DOCKING_LIG2_m3.pdb
						...
						DOCKING_LIG3_m1.pdb
						DOCKING_LIG3_m2.pdb
						DOCKING_LIG3_m3.pdb
						...
					DOCKING_alldata.csv
					DOCKING.p
					DOCKING_clustering.csv [[DOCKING_pose_pose_aiads.csv]]
					[[DOCKING_best_aiad_pairs.csv]]
					[[graphs/]]
						[[...graphs...]]


## Usage (to be written)
* Preparation
* Uploading
* Submission
* Downloading
* Processing
* Analysis

## Example Files
* Example of `Dockings.csv`

			Docking ID,Date,Protein,Ligset,Gridbox,Exhaustiveness,Number of Models,Number of CPUs,Notes
			DOCK_A1,20160301,PROT_A,LIGSET1,BOX_AAS,20,10,2,looking at active size of protein A
			DOCK_A2,20160308,PROT_A,LIGSET2,BOX_AWP,50,400,4,high volume docking of whole protein A
			DOCK_B1,20160308,PROT_B,LIGSET3,BOX_BWP,8,20,1,initial docking of whole protein B
	* AKA:

		<table border="1" style="width:100%;font-size:10pt;border-spacing:0px" font size="1">
			<tr>
				<th>Docking ID</th>
				<th>Date</th>
				<th>Protein</th>
				<th>Ligset</th>
				<th>Gridbox</th>
				<th>Exhaustiveness</th>
				<th>Number of Models</th>
				<th>Number of CPUs</th>
				<th>Notes</th>
			</tr>
			<tr>
				<td>DOCK_A1</td>
				<td>20160301</td>
				<td>PROT_A</td>
				<td>LIGSET1</td>
				<td>BOX_AAS</td>
				<td>20</td>
				<td>10</td>
				<td>2</td>
				<td>looking at active size of protein A</td>
			</tr>
			<tr>
				<td>DOCK_A2</td>
				<td>20160308</td>
				<td>PROT_A</td>
				<td>LIGSET2</td>
				<td>BOX_AWP</td>
				<td>50</td>
				<td>400</td>
				<td>4</td>
				<td>high volume docking of whole protein A</td>
			</tr>
			<tr>
				<td>DOCK_B1</td>
				<td>20160308</td>
				<td>PROT_B</td>
				<td>LIGSET3</td>
				<td>BOX_BWP</td>
				<td>8</td>
				<td>20</td>
				<td>1</td>
				<td>initial docking of whole protein B</td>
			</tr>
		</table>

* Example of `Gridboxes.csv`

			Gridbox Name,Protein,Size in x-dimension,Size in y-dimension,Size in z-dimension,Center in x-dimension,Center in y-dimension,Center in z-dimension,Notes
			BOX_AAS,PROT_A,60,72,88,41.89,2.69,-1.85,active site of protein A
			BOX_AWP,PROT_A,126,126,126,41.89,2.69,-1.85,all of protein A
			BOX_BWP,PROT_B,126,126,126,4.89,-5.27,12.0,all of protein B
	* AKA:

		<table border="1" style="width:100%;font-size:10pt;border-spacing:0px" font size="1">
			<tr>
				<th>Gridbox Name</th>
				<th>Protein</th>
				<th>Size in x-dimension</th>
				<th>Size in y-dimension</th>
				<th>Size in z-dimension</th>
				<th>Center in x-dimension</th>
				<th>Center in y-dimension</th>
				<th>Center in z-dimension</th>
				<th>Notes</th>
			</tr>
			<tr>
				<td>BOX_AAS</td>
				<td>PROT_A</td>
				<td>60</td>
				<td>72</td>
				<td>88</td>
				<td>41.89</td>
				<td>2.69</td>
				<td>-1.85</td>
				<td>active site of protein A</td>
			</tr>
			<tr>
				<td>BOX_AWP</td>
				<td>PROT_A</td>
				<td>126</td>
				<td>126</td>
				<td>126</td>
				<td>41.89</td>
				<td>2.69</td>
				<td>-1.85</td>
				<td>all of protein A</td>
			</tr>
			<tr>
				<td>BOX_BWP</td>
				<td>PROT_B</td>
				<td>126</td>
				<td>126</td>
				<td>126</td>
				<td>4.89</td>
				<td>-5.27</td>
				<td>12.0</td>
				<td>all of protein B</td>
			</tr>
		</table>

* Example of a `DOCK_parameters.csv` file

			parameter,value
			dock,DOCK_A1
			prot,PROT_A
			ligset,LIGSET1
			box,BOX_AAS
			box_center_x,41.89
			box_center_y,2.69
			box_center_z,-1.85
			box_size_x,60
			box_size_y,72
			box_size_z,88
			exhaust,20
			n_models,10
			n_cpus,2
	* AKA:

		<table border="1" style="width:30%;font-size:10pt;border-spacing:0px" font size="1">
			<tr>
				<th>parameter</th>
				<th>value</th>
			</tr>
			<tr>
				<td>dock</td>
				<td>DOCK_A1</td>
			</tr>
			<tr>
				<td>prot</td>
				<td>PROT_A</td>
			</tr>
			<tr>
				<td>ligset</td>
				<td>LIGSET1</td>
			</tr>
			<tr>
				<td>box</td>
				<td>BOX_AAS</td>
			</tr>
			<tr>
				<td>box_center_x</td>
				<td>41.89</td>
			</tr>
			<tr>
				<td>box_center_y</td>
				<td>2.69</td>
			</tr>
			<tr>
				<td>box_center_z</td>
				<td>-1.85</td>
			</tr>
			<tr>
				<td>box_size_x</td>
				<td>60</td>
			</tr>
			<tr>
				<td>box_size_y</td>
				<td>72</td>
			</tr>
			<tr>
				<td>box_size_z</td>
				<td>88</td>
			</tr>
			<tr>
				<td>exhaust</td>
				<td>20</td>
			</tr>
			<tr>
				<td>n_models</td>
				<td>10</td>
			</tr>
			<tr>
				<td>n_cpus</td>
				<td>2</td>
			</tr>
		</table>

## Resources
* [Info about Vina](http://vina.scripps.edu)
* [Taylor Group Website](http://eataylor.faculty.wesleyan.edu/)
* [Contact Zarek](mailto:zsiegel@wesleyan.edu)

</body>

